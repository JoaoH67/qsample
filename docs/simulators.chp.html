---

title: CHP Simulator


keywords: fastai
sidebar: home_sidebar

summary: "Implementation of the Aarenson/Gottesman CHP stabilizer simulator"
description: "Implementation of the Aarenson/Gottesman CHP stabilizer simulator"
nb_path: "03b_simulators.chp.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03b_simulators.chp.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Original paper <a href="https://arxiv.org/pdf/quant-ph/0406196.pdf">https://arxiv.org/pdf/quant-ph/0406196.pdf</a><br></li>
</ul>
<p>This simulator updates the stabilizer generators of an n-qubit state (initially in $|00..0 \rangle$) after each gate application. It implements the fundamental gates CNOT, Hadamard and Phase (S-gate) from which all other gates of the Clifford group can be generated. The foundation of this simulator follows the above mentioned paper very closely and was originally written by Craig Gidney. The implementation is well tested and comes with a lot of nice tests written by the original author. [1]</p>
<p>[1] <a href="https://github.com/Strilanc/python-chp-stabilizer-simulator">https://github.com/Strilanc/python-chp-stabilizer-simulator</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ChpSimulator" class="doc_header"><code>class</code> <code>ChpSimulator</code><a href="https://github.com/dpwinter/qsam/tree/master/qsam/simulators/chp.py#L80" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ChpSimulator</code>(<strong><code>num_qubits</code></strong>) :: <a href="/qsam/simulators.simulator.html#Simulator"><code>Simulator</code></a></p>
</blockquote>
<p>The bare minimum needed for the CHP simulation.</p>
<p>Reference:
    "Improved Simulation of Stabilizer Circuits"
    Scott Aaronson and Daniel Gottesman
    <a href="https://arxiv.org/abs/quant-ph/0406196">https://arxiv.org/abs/quant-ph/0406196</a></p>
<p>Original author:
    Craig Gidney
    <a href="https://github.com/Strilanc/python-chp-stabilizer-simulator">https://github.com/Strilanc/python-chp-stabilizer-simulator</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Following are tests of the implementation authored by Craig Gidney.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Set</span>
<span class="kn">import</span> <span class="nn">itertools</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test the phase of a Pauli product $\sigma_i \sigma_j$. Output is in powers of i, i.e. $i^k=\{-i,1,i\}$ for $\{-1,0,1\}$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_pauli_product_phase</span><span class="p">():</span>
    <span class="n">paulis</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>  <span class="c1"># I</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>  <span class="c1"># X</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>  <span class="c1"># Y</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>  <span class="c1"># Z</span>
    <span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]</span>
    <span class="k">assert</span> <span class="n">pauli_product_phase</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">pauli_product_phase</span><span class="p">(</span><span class="o">*</span><span class="n">paulis</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">*</span><span class="n">paulis</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="n">expected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>

<span class="n">test_pauli_product_phase</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test that one qubit is initialized in $|0\rangle$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_identity</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">test_identity</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test $\langle 0|XZX|0\rangle=1$</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_bit_flip</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">test_bit_flip</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test that two qubits are initialized in $|00\rangle$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_identity_2</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">test_identity_2</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test $|\langle 0_A 0_B|X_AZ_AZ_BX_A|0_A0_B\rangle|^2=1$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_bit_flip_2</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">test_bit_flip_2</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test  $\frac{1}{2} (\langle 0_A0_B|+\langle 1_A1_B|) Z_A (|0_A0_B\rangle+|1_A1_B\rangle)= \langle -_B| Z_B | -_B \rangle$.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_epr</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">v1</span><span class="o">.</span><span class="n">determined</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">v2</span><span class="o">.</span><span class="n">determined</span>
    <span class="k">assert</span> <span class="n">v1</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">v2</span><span class="o">.</span><span class="n">value</span>
    
<span class="n">test_epr</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And some more involved tests:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_phase_kickback_consume_s_state</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">v1</span><span class="o">.</span><span class="n">determined</span>
    <span class="k">if</span> <span class="n">v1</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">test_phase_kickback_consume_s_state</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_phase_kickback_preserve_s_state</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Prepare S state.</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Prepare test input.</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Kickback.</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Check.</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">test_phase_kickback_preserve_s_state</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_kickback_vs_stabilizer</span><span class="p">():</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">-YII</span>
<span class="s2">-IYI</span>
<span class="s2">+IIX</span>
<span class="s2">----</span>
<span class="s2">+XIX</span>
<span class="s2">+IXX</span>
<span class="s2">+YYZ</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">+XIX</span>
<span class="s2">-IYI</span>
<span class="s2">+IIX</span>
<span class="s2">----</span>
<span class="s2">+ZII</span>
<span class="s2">+IXX</span>
<span class="s2">+ZYY</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">+XIX</span>
<span class="s2">+IXX</span>
<span class="s2">+IIX</span>
<span class="s2">----</span>
<span class="s2">+ZII</span>
<span class="s2">+IZI</span>
<span class="s2">-ZZZ</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">+XIX</span>
<span class="s2">+IXX</span>
<span class="s2">+IIX</span>
<span class="s2">----</span>
<span class="s2">+ZII</span>
<span class="s2">+IZI</span>
<span class="s2">-ZZZ</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">v0</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">v2</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="n">test_kickback_vs_stabilizer</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_s_state_distillation_low_depth</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

        <span class="n">stabilizers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">stabilizers</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">stabilizers</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span>
            <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">stabilizers</span><span class="p">[</span><span class="mi">2</span><span class="p">]},</span>
        <span class="p">]</span>

        <span class="n">stabilizer_measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">anc</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="k">for</span> <span class="n">stabilizer</span> <span class="ow">in</span> <span class="n">stabilizers</span><span class="p">:</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">stabilizer</span><span class="p">:</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">anc</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">determined</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">stabilizer_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">qubit_measurements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">qubit_measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">stabilizer_measurements</span> <span class="o">+</span> <span class="n">qubit_measurements</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

        <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">r</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">:</span>
            <span class="n">rvs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">stabilizer_measurements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]]</span>
            <span class="n">rms</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">qubit_measurements</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]]</span>
            <span class="k">assert</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rvs</span> <span class="o">+</span> <span class="n">rms</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span>
            
<span class="n">test_s_state_distillation_low_depth</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_s_state_distillation_low_space</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">phasors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">anc</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">phasor</span> <span class="ow">in</span> <span class="n">phasors</span><span class="p">:</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">phasor</span><span class="p">:</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">anc</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">determined</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">phasor</span> <span class="o">+</span> <span class="p">(</span><span class="n">anc</span><span class="p">,):</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">MeasureResult</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">determined</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
<span class="n">test_s_state_distillation_low_space</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_count_s_state_distillation_failure_cases</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">distill</span><span class="p">(</span><span class="n">errors</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">ChpSimulator</span><span class="p">(</span><span class="n">num_qubits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">phasors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">anc</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">phasor</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phasors</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">phasor</span><span class="p">:</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">cnot</span><span class="p">(</span><span class="n">anc</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>

            <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
                <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">determined</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">phasor</span><span class="p">:</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">hadamard</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">[</span><span class="n">sim</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">determined</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">determined</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">)</span>
        <span class="n">good_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="n">checks_passed</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">checks</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checks_passed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">good_result</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;good&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;ERROR&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">good_result</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;victim&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;caught&#39;</span>

    <span class="k">def</span> <span class="nf">classify</span><span class="p">(</span><span class="n">errs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errs</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">distill</span><span class="p">(</span><span class="n">err</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">nones</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">singles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">doubles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">triples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">assert</span> <span class="n">classify</span><span class="p">(</span><span class="n">nones</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;good&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">classify</span><span class="p">(</span><span class="n">singles</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;caught&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;victim&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">classify</span><span class="p">(</span><span class="n">doubles</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;caught&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;victim&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
    <span class="k">assert</span> <span class="n">classify</span><span class="p">(</span><span class="n">triples</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;caught&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;victim&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
    
<span class="n">test_count_s_state_distillation_failure_cases</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>


