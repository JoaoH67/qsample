# AUTOGENERATED! DO NOT EDIT! File to edit: 02_circuit.ipynb (unless otherwise specified).

__all__ = ['Circuit', 'unpack', 'partition']

# Cell
from .nbtools import patch
from collections.abc import MutableSequence

# Cell
class Circuit(MutableSequence):

    """Representation of a quantum circuit"""
    def __init__(self, ticks=None):
        self._ticks = ticks if ticks else []

    def __getitem__(self, tick_index):
        return self._ticks[tick_index]

    def __setitem__(self, tick_index, tick):
        self._ticks[tick_index] = tick

    def __delitem__(self, tick_index):
        del self._ticks[tick_index]

    def __len__(self):
        return len(self._ticks)

    def insert(self, tick_index, tick):
        self._ticks.insert(tick_index, tick)

    def __str__(self):
        str_list = []
        for i, tick in enumerate(self._ticks):
            str_list.append(f"{i}: {str(tick)}")
        return "\n".join(str_list)

    def __repr__(self):
        return self.__str__()

# Cell
def unpack(seq):
    if isinstance(seq, (tuple,set,list)):
        yield from (x for y in seq for x in unpack(y))
    elif isinstance(seq, dict):
        yield from (x for v in seq.values() for y in v for x in unpack(y))
    else:
        yield seq

# Cell
Circuit.qubits = property(lambda self: set(unpack(self._ticks)))
Circuit.n_qubits = property(lambda self: len(self.qubits))

# Cell
@patch(Circuit)
def partition(self, gateset):
    [(tick_idx,) for tick_idx,tick in enumerate(self._ticks) for gate,qbs in tick.items() if gate.upper() in gateset]